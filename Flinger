-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- === GUI Setup ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FlingGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame
local Target_Section = Instance.new("Frame")
Target_Section.Name = "Target_Section"
Target_Section.Size = UDim2.new(0, 200, 0, 200)
Target_Section.Position = UDim2.new(0, 50, 0, 50)
Target_Section.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Target_Section.BorderSizePixel = 0
Target_Section.Active = true
Target_Section.Draggable = true
Target_Section.Parent = screenGui

-- TargetName TextBox
local TargetNameBox = Instance.new("TextBox")
TargetNameBox.Name = "TargetNameBox"
TargetNameBox.Size = UDim2.new(0, 150, 0, 30)
TargetNameBox.Position = UDim2.new(0, 25, 0, 50)
TargetNameBox.PlaceholderText = "Enter target name"
TargetNameBox.Text = ""
TargetNameBox.TextScaled = true
TargetNameBox.Font = Enum.Font.Oswald
TargetNameBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
TargetNameBox.TextColor3 = Color3.fromRGB(0, 0, 0)
TargetNameBox.ClearTextOnFocus = false
TargetNameBox.Parent = Target_Section

-- Fling Button
local FlingTarget_Button = Instance.new("TextButton")
FlingTarget_Button.Name = "FlingTarget_Button"
FlingTarget_Button.Size = UDim2.new(0, 150, 0, 30)
FlingTarget_Button.Position = UDim2.new(0, 25, 0, 100)
FlingTarget_Button.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
FlingTarget_Button.BackgroundTransparency = 0.5
FlingTarget_Button.BorderSizePixel = 0
FlingTarget_Button.Font = Enum.Font.Oswald
FlingTarget_Button.Text = "Fling"
FlingTarget_Button.TextColor3 = Color3.fromRGB(0, 0, 0)
FlingTarget_Button.TextScaled = true
FlingTarget_Button.TextWrapped = true
FlingTarget_Button.Parent = Target_Section

-- Stop Button
local StopFling_Button = Instance.new("TextButton")
StopFling_Button.Name = "StopFling_Button"
StopFling_Button.Size = UDim2.new(0, 150, 0, 30)
StopFling_Button.Position = UDim2.new(0, 25, 0, 140)
StopFling_Button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
StopFling_Button.BackgroundTransparency = 0.5
StopFling_Button.BorderSizePixel = 0
StopFling_Button.Font = Enum.Font.Oswald
StopFling_Button.Text = "Stop"
StopFling_Button.TextColor3 = Color3.fromRGB(0, 0, 0)
StopFling_Button.TextScaled = true
StopFling_Button.TextWrapped = true
StopFling_Button.Parent = Target_Section

-- === Variables ===
local flingConnection = nil
local currentTarget = nil

-- === Utility ===
local function trim(s)
	return s:match("^%s*(.-)%s*$")
end

local function getPlayerByPartialName(namePart)
	local lowerNamePart = namePart:lower()
	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Name:lower():sub(1, #lowerNamePart) == lowerNamePart then
			return player
		end
	end
	return nil
end

-- === Fling Logic ===
local function startFling(targetPlayer)
	if not targetPlayer or not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
		warn("Target player or their HumanoidRootPart not found.")
		return
	end

	local myChar = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local myHRP = myChar:WaitForChild("HumanoidRootPart")

	local targetHRP = targetPlayer.Character:WaitForChild("HumanoidRootPart")

	currentTarget = targetPlayer

	flingConnection = RunService.Heartbeat:Connect(function()
		if not targetPlayer or not targetPlayer.Character or not targetHRP or not myChar or not myHRP then
			return
		end
		myHRP.CFrame = targetHRP.CFrame
		myHRP.AssemblyLinearVelocity = Vector3.new(500, 500, 500)
	end)
end

local function stopFling()
	if flingConnection then
		flingConnection:Disconnect()
		flingConnection = nil
	end
	currentTarget = nil
end

-- === Join/Leave Player Handling ===
local function onPlayerAdded(player)
	print("[+] Player joined:", player.Name)
end

local function onPlayerRemoving(player)
	print("[-] Player left:", player.Name)
	if player == currentTarget then
		stopFling()
		warn("Target player left the game. Fling stopped.")
	end
end

-- Connect to events
Players.PlayerAdded:Connect(onPlayerAdded)
Players.PlayerRemoving:Connect(onPlayerRemoving)

-- Run once for existing players
for _, player in ipairs(Players:GetPlayers()) do
	if player ~= LocalPlayer then
		onPlayerAdded(player)
	end
end

-- === Button Events ===
FlingTarget_Button.MouseButton1Click:Connect(function()
	local inputName = trim(TargetNameBox.Text)
	if inputName == "" then
		warn("Please enter a target name.")
		return
	end

	local targetPlayer = getPlayerByPartialName(inputName)
	if targetPlayer then
		startFling(targetPlayer)
	else
		warn("Player not found.")
	end
end)

StopFling_Button.MouseButton1Click:Connect(function()
	stopFling()
end)
