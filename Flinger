-- Services & Variables
local Players = game:GetService("Players")
local plr = Players.LocalPlayer
local StopFling = false

-- GUI Elements
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")

local UsernameBox = Instance.new("TextBox")
local StartButton = Instance.new("TextButton")
local StopButton = Instance.new("TextButton")

local StartBackground = Instance.new("Frame")
local StopBackground = Instance.new("Frame")

local FrameCorner = Instance.new("UICorner")
local UsernameCorner = Instance.new("UICorner")
local StartCorner = Instance.new("UICorner")
local StartBgCorner = Instance.new("UICorner")
local StopCorner = Instance.new("UICorner")
local StopBgCorner = Instance.new("UICorner")

-- Parent GUI
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Frame
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.Position = UDim2.new(0.05, 0, 0.3, 0)
MainFrame.Size = UDim2.new(0, 200, 0, 200)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true

FrameCorner.CornerRadius = UDim.new(0, 12)
FrameCorner.Parent = MainFrame

-- Username Box
UsernameBox.Parent = MainFrame
UsernameBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
UsernameBox.Position = UDim2.new(0.05, 0, 0.05, 0)
UsernameBox.Size = UDim2.new(0, 180, 0, 30)
UsernameBox.PlaceholderText = "Enter Username"
UsernameBox.TextColor3 = Color3.fromRGB(0, 0, 0)
UsernameBox.Font = Enum.Font.SourceSans
UsernameBox.TextSize = 18
UsernameBox.ClearTextOnFocus = false

UsernameCorner.CornerRadius = UDim.new(0, 8)
UsernameCorner.Parent = UsernameBox

-- Start Background
StartBackground.Name = "StartBackground"
StartBackground.Parent = MainFrame
StartBackground.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
StartBackground.Position = UDim2.new(0.05, 0, 0.25, 0)
StartBackground.Size = UDim2.new(0, 180, 0, 30)
StartBackground.ZIndex = 1

StartBgCorner.CornerRadius = UDim.new(0, 8)
StartBgCorner.Parent = StartBackground

-- Start Button
StartButton.Parent = StartBackground
StartButton.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
StartButton.Size = UDim2.new(1, 0, 1, 0)
StartButton.Text = "Start"
StartButton.TextColor3 = Color3.new(0, 0, 0)
StartButton.Font = Enum.Font.SourceSansBold
StartButton.TextSize = 20
StartButton.ZIndex = 2

StartCorner.CornerRadius = UDim.new(0, 8)
StartCorner.Parent = StartButton

-- Stop Background
StopBackground.Name = "StopBackground"
StopBackground.Parent = MainFrame
StopBackground.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
StopBackground.Position = UDim2.new(0.05, 0, 0.45, 0)
StopBackground.Size = UDim2.new(0, 180, 0, 30)
StopBackground.ZIndex = 1

StopBgCorner.CornerRadius = UDim.new(0, 8)
StopBgCorner.Parent = StopBackground

-- Stop Button
StopButton.Parent = StopBackground
StopButton.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
StopButton.Size = UDim2.new(1, 0, 1, 0)
StopButton.Text = "Stop"
StopButton.TextColor3 = Color3.new(0, 0, 0)
StopButton.Font = Enum.Font.SourceSansBold
StopButton.TextSize = 20
StopButton.ZIndex = 2

StopCorner.CornerRadius = UDim.new(0, 8)
StopCorner.Parent = StopButton

-- Utility Function: Get HumanoidRootPart
function GetRoot(player)
	if player and player.Character then
		return player.Character:FindFirstChild("HumanoidRootPart")
	end
end

-- TODO: Define these functions yourself
function ToggleFling(state)
	print("ToggleFling: ", state)
	-- Add fling logic here
end

function PredictionTP(player, mode)
	print("Teleporting to: " .. player.Name)
	-- Add prediction teleport logic here
end

function TeleportTO(x, y, z, mode, safety)
	print(string.format("Teleporting back to: (%.1f, %.1f, %.1f)", x, y, z))
	-- Add teleport-to-position logic here
end

-- Button Events
StartButton.MouseButton1Click:Connect(function()
	local enteredName = UsernameBox.Text
	local targetPlayer = Players:FindFirstChild(enteredName)

	-- List all players in output
	for _, player in pairs(Players:GetPlayers()) do
		print("Player found: " .. player.Name)
	end

	if targetPlayer then
		print("Targeting player: " .. targetPlayer.Name)
		local oldPos = GetRoot(plr).Position
		ToggleFling(true)
		StopFling = false

		task.spawn(function()
			repeat
				task.wait()
				pcall(function()
					PredictionTP(targetPlayer, "safe")
				end)
			until StopFling

			TeleportTO(oldPos.X, oldPos.Y, oldPos.Z, "pos", "safe")
		end)
	else
		warn("Player not found.")
	end
end)

StopButton.MouseButton1Click:Connect(function()
	ToggleFling(false)
	StopFling = true
	print("Stopped fling loop.")
end)
